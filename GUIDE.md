# Using Ruby with BitPay

## Prerequisites
To follow this guide, you must have [a working BitPay Client ID](http://dev.bitpay.com/docs/getting-started.html).

## Ruby Quick Start
### Installation
```bash
gem install bitpay-sdk
```

In your Gemfile:
```ruby
gem 'bitpay-sdk', :require => 'bitpay_sdk'
```

Or directly:

```ruby
require 'bitpay_sdk'
```

#### Pairing with BitPay.com
BitPay's API requires 
```ruby
client = BitPay::Client.new
client.pair_pos_client(<pairing_code>)
invoice = client.create_invoice (price: <price>, currency: <currency>)
```

#### Configuration
The BitPay Ruby library creates a cryptographically secure connection to your server by pairing an API code with keys generated by the library. The client can be initialized with pre-existing keys passed in as a pem file, or paired if initialized with a pem file and a tokens hash. Examples can be found in the cucumber step helpers.

## Creating Invoices
With invoice creation, `price` and `currency` are the only required fields. If you are sending a customer from your website to make a purchase, setting `redirectURL` will redirect the customer to your website when the invoice is paid.

```ruby
invoice = client.create_invoice (price: <price>, currency: <currency>)
```

Response will be a hash with information on your newly created invoice. Send your customer to the `url` to complete payment:

```javascript
{
  "id"             => "DGrAEmbsXe9bavBPMJ8kuk", 
  "url"            => "https://bitpay.com/invoice?id=DGrAEmbsXe9bavBPMJ8kuk",
  "status"         => "new",
  "btcPrice"       => "0.0495",
  "price"          => 10,
  "currency"       => "USD",
  "invoiceTime"    => 1383265343674,
  "expirationTime" => 1383266243674,
  "currentTime"    => 1383265957613
}
```

There are many options available when creating invoices, which are listed in the [BitPay API documentation](https://bitpay.com/bitcoin-payment-gateway-api).

To get updated information on this invoice, make a get call with the id returned:

```ruby
invoice = client.get_public_invoice(id: 'DGrAEmbsXe9bavBPMJ8kuk')
```

## Testnet Usage

During development and testing, take advantage of the [Bitcoin TestNet](https://en.bitcoin.it/wiki/Testnet) by passing a custom `api_uri` option on initialization:

```ruby
BitPay::Client.new(api_uri: "https://test.bitpay.com/api")
```
